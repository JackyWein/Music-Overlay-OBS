/* ========== ENTRY: CRYSTAL SHATTER ========== */

/* Exit: Crystal Explode */
.exit-crystal {
    animation: crystal-explode 0.6s cubic-bezier(0.5, 0, 0.5, 1) forwards;
}

@keyframes crystal-explode {
    0% {
        transform: scale(1);
        opacity: 1;
        clip-path: circle(50% at 50% 50%);
    }

    20% {
        transform: scale(0.9);
        filter: brightness(1.5);
    }

    40% {
        clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%);
        /* Diamond shape crack */
    }

    100% {
        transform: scale(1.5);
        opacity: 0;
        clip-path: polygon(0% 0%, 100% 0%, 100% 100%, 0% 100%);
        /* Full expand with fade */
        filter: drop-shadow(0 0 10px white);
    }
}

/* Entry: Crystal Reform */
.entry-crystal {
    animation: crystal-reform 1s cubic-bezier(0.1, 0.9, 0.2, 1) forwards;
}

@keyframes crystal-reform {
    0% {
        opacity: 0;
        transform: scale(1.2) rotate(15deg);
        filter: drop-shadow(0 0 20px white);
        clip-path: polygon(20% 0%, 80% 0%, 100% 20%, 100% 80%, 80% 100%, 20% 100%, 0% 80%, 0% 20%);
    }

    30% {
        opacity: 1;
        transform: scale(0.8) rotate(-5deg);
        clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%);
        /* Diamond */
        filter: contrast(150%) brightness(1.5);
    }

    60% {
        transform: scale(1.05) rotate(2deg);
        clip-path: polygon(10% 10%, 90% 10%, 90% 90%, 10% 90%);
        /* Square-ish */
        filter: contrast(120%);
    }

    100% {
        opacity: 1;
        transform: scale(1) rotate(0);
        filter: none;
        clip-path: circle(50% at 50% 50%);
        /* Final Circle */
    }
}

/* Crystal Shards Effect */
.crystal-shard {
    position: absolute;
    background: rgba(255, 255, 255, 0.8);
    width: 20px;
    height: 40px;
    clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%);
    pointer-events: none;
    z-index: 50;
    opacity: 0;
}

.crystal-shard.active {
    animation: shard-fly-in 0.8s ease-out forwards;
}

@keyframes shard-fly-in {
    0% {
        opacity: 0;
        transform: translate(var(--tx), var(--ty)) rotate(var(--rot)) scale(0);
    }

    50% {
        opacity: 1;
        transform: translate(0, 0) rotate(0) scale(1.2);
    }

    100% {
        opacity: 0;
        transform: translate(0, 0) rotate(0) scale(0);
        /* Merge into center */
    }
}